:title: Setting Up Keycloak as a Credential Issuer with OpenID4VCI
:date: 2025-11-28
:publish: true
:author: Rodrick Awambeng, Forkim Enjeckayang, Ingrid Kamga, Bertrand Ogen
:summary: Keycloak implements OpenID for Verifiable Credential Issuance (OpenID4VCI), enabling users to be issued verifiable credentials as a digital proof of their identity. However, several components need to be consistently configured to enable this functionality.

Keycloak implements https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html[OpenID for Verifiable Credential Issuance] (OpenID4VCI), enabling users to be issued verifiable credentials as a digital proof of their identity.
However, several components need to be consistently configured to enable this functionality, from realm to client to issuable credential (as client scope).

NOTE: At the time of writing this blog, Keycloak's support for OpenID4VCI is still experimental. This guide uses the **main branch snapshot version** `999.0.0-SNAPSHOT`, and the feature is expected to be promoted to preview in early 2026.

This blog post builds on a simple scenario to illustrate how to set up Keycloak for OpenID4VCI.
Here is the scenario: The Keycloak OAuth SIG team wants to issue verifiable credentials to its members as a proof of membership.
The membership credential will contain the member's name and email, which can be later presented at an onsite or virtual event for access granting.

== Verifiable Credentials and OpenID for Verifiable Credential Issuance

https://ec.europa.eu/digital-building-blocks/sites/spaces/EBSI/pages/600343491/EBSI+Verifiable+Credentials[Verifiable Credentials] (VCs) are a digital representation of credentials that can be cryptographically verified.
They enable secure and privacy-preserving sharing of information between parties.
VCs are designed to be tamper-evident and can be issued, held, and presented by individuals or entities.
From a conceptual standpoint, Keycloak, as an identity and access management solution, can therefore be set to issue VCs to users as a standalone digital proof of their identity.
Such may also be referred to as Identity Credentials.

--
++++
<div class="paragraph" style="margin-top:1em;margin-bottom:2em;">
    <img src="${blogImages}/openid4vci/triangle-of-trust.png" alt="Triangle of trust or Issuer-Holder-Verifier model" style="border:none;display:block;max-width:100%;height:auto;margin:0 auto;">
    <p style="text-align:center;font-style:italic">Triangle of trust or Issuer-Holder-Verifier model</p>
</div>
++++
--

As part of the family of https://openid.net/wg/digital-credentials-protocols/specifications[OpenID for Verifiable Credentials] (OpenID4VC) specifications, https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0.html[OpenID4VCI] is a protocol that extends the OpenID Connect framework to facilitate the issuance of verifiable credentials.
It provides a standardized way for issuers to issue VCs to holders, allowing for interoperability and secure communication between different systems.
Keycloak implements OpenID4VCI to act as an *Issuer* of verifiable credentials for its user knowledge base.

In general, these credentials are intended to be used in scenarios where trusting parties need to independently verify user identities or attributes associated with a Keycloak authorization server, such as in our scenario where members of the OAuth SIG need to prove their membership status at an event venue.

== Configuring Keycloak for OpenID4VCI

OpenID4VCI in Keycloak is offered via the feature flag `openid4vci`, which consequently needs to be enabled at startup.

[source,bash]
----
--features=openid4vci
----

That said, we now assume that you have a running Keycloak instance with the `openid4vci` feature flag enabled.

Beyond enabling the feature flag, the following configuration steps need to be taken consistently, in accordance with your use case:

- Configure OpenID4VCI at the realm level
- Configure an issuable verifiable credential (as a dedicated client scope)
- Enable and configure OpenID4VCI at the client level

Because some configurations are not yet supported via the Keycloak Admin Console, we may often use the Admin REST API to communicate required configurations.

=== Configuring OpenID4VCI at the realm level

Let's assume you have already created a realm named `oauth-sig-realm` to represent the OAuth SIG group, and that a couple of users have also been created in this realm, each with a password assigned, to represent members of the group.
In addition, any user who is intended to create credential offers must be granted the `credential-offer-create` role. This ensures that only authorized users can generate credential offers, maintaining the security of the issuance process.

--
++++
<img src="${blogImages}/openid4vci/screenshot-realm-and-users.png" style="margin-bottom:2em" alt="Screenshot: Realm and Users">
++++
--

The behavior of OpenID4VCI across the entire realm can be modulated via realm attributes.
On the Admin Console, find the *OID4VCI Attributes* section under the *Realm Settings > Tokens* tab.

--
++++
<img src="${blogImages}/openid4vci/screenshot-realm-config-oid4vci-attributes.png" style="margin-bottom:2em" alt="Screenshot: OID4VCI Attributes">
++++
--

Sensible defaults apply out of the box, but for the sake of this demo, we would want, for instance, to increase the value of **Pre-Authorized Code Lifespan** to 3 minutes so that the issuance flow expires less quickly.
To learn more about the **Nonce Lifetime** and other realm attributes for OpenID4VCI not accessible via the Admin Console, please refer to the main https://github.com/keycloak/keycloak/blob/main/docs/documentation/server_admin/topics/oid4vci/vc-issuer-configuration.adoc[Keycloak documentation].

Lastly, because EC cryptography is highly encouraged in the OpenID4VC ecosystem, we also invite you to add an EC key pair to the realm's set of keys under *Realm Settings > Keys > Providers*.
This will later enable configuring the signing of issued VCs with algorithm `ES256`.

--
++++
<img src="${blogImages}/openid4vci/screenshot-realm-ecdsa-generated-provider.png" style="margin-bottom:2em" alt="Screenshot: Adding ECDSA Key Provider">
++++
--

=== Configuring an issuable verifiable credential (as a dedicated client scope)

Different credential types can be configured for issuance depending on what data the credential should embed, what format it should have, or other criteria.
Each credential type is configured as a dedicated client scope of protocol type "OpenID for Verifiable Credentials".

We will configure our membership credential to be issued as an SD-JWT credential carrying a user's first name, last name, and email.
Each claim to be added to the credential requires a corresponding protocol mapper from the User Model to the credential.
Other fields such as the time of issuance or a unique identifier for the credential are supported via other types of protocol mappers.

Since we will be using the Admin REST API to configure the client scope, we first need to obtain a valid Admin Token from the `master` realm to authorize our requests. This prevents the common `{"error":"HTTP 401 Unauthorized"}` error.

[source,sh]
----
ADMIN_TOKEN=$(curl -s -X POST "http://<keycloak.instance>/realms/master/protocol/openid-connect/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=<admin-username>" \
  -d "password=<admin-password>" \
  -d "grant_type=password" \
  -d "client_id=admin-cli" | jq -r '.access_token' )
echo "Admin Token obtained: $ADMIN_TOKEN"
----

Now, let's proceed with adding the membership credential type as a dedicated client scope using the Admin REST API.

[source,sh]
----
curl -X POST "http://<keycloak.instance>/admin/realms/oauth-sig-realm/client-scopes" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -d '{
    "name": "membership-credential",
    "protocol": "oid4vc",
    "attributes": {
      "include.in.token.scope": "true",
      "vc.format": "dc+sd-jwt",
      "vc.verifiable_credential_type": "https://credentials.example.com/oauth-sig-membership",
      "vc.proof_signing_alg_values_supported": "ES256",
      "vc.display": "[{\"name\": \"OAuth SIG Membership\", \"locale\":\"en\"}]",
      "vc.issuer_did": "http://<keycloak.instance>/realms/oauth-sig-realm",
      "vc.credential_build_config.token_jws_type": "dc+sd-jwt"
    },
    "protocolMappers": [
      {
        "name": "given_name-mapper",
        "protocol": "oid4vc",
        "protocolMapper": "oid4vc-user-attribute-mapper",
        "config": {
          "claim.name": "given_name",
          "userAttribute": "firstName",
          "vc.display": "[{\"name\":\"Given Name\",\"locale\":\"en\"}]"
        }
      },
      {
        "name": "family_name-mapper",
        "protocol": "oid4vc",
        "protocolMapper": "oid4vc-user-attribute-mapper",
        "config": {
          "claim.name": "family_name",
          "userAttribute": "lastName",
          "vc.display": "[{\"name\":\"Family Name\",\"locale\":\"en\"}]"
        }
      },
      {
        "name": "email-mapper",
        "protocol": "oid4vc",
        "protocolMapper": "oid4vc-user-attribute-mapper",
        "config": {
          "claim.name": "email",
          "userAttribute": "email",
          "vc.display": "[{\"name\":\"Email\",\"locale\":\"en\"}]"
        }
      },
      {
        "name": "iat-mapper",
        "protocol": "oid4vc",
        "protocolMapper": "oid4vc-issued-at-time-claim-mapper",
        "config": {
          "claim.name": "iat",
          "truncateToTimeUnit": "HOURS",
          "valueSource": "COMPUTE"
        }
      }
    ]
  }'
----

Commenting on the above configuration:

- Attribute `vc.format` defines the format of the credential whereas `vc.verifiable_credential_type` specifies the `vct` property's value.
- All `vc.display` entries are intended to be used by a wallet to display intelligible descriptions.
- Known bugs mandate configuring the credential signing algorithm via `vc.proof_signing_alg_values_supported`.
- To learn more about other used or available configuration attributes, please refer to the main https://github.com/keycloak/keycloak/blob/main/docs/documentation/server_admin/topics/oid4vci/vc-issuer-configuration.adoc#create-client-scopes-with-mappers[Keycloak documentation].

Verify that the client scope was created successfully by checking the Admin Console under *Client Scopes*.
Additionally, place a GET call on the Credential Issuer Metadata Endpoint to verify that the newly created credential type is listed among issuable credentials, in accordance with the above configuration.

[source,sh]
----
curl -X GET "http://<keycloak.instance>/.well-known/openid-credential-issuer/realms/oauth-sig-realm" \
  -H "Accept: application/json"
----

[source,json5]
----
{
  // ...
  "credential_configurations_supported": {
    "membership-credential": {
      "id": "membership-credential",
      "format": "dc+sd-jwt",
      "scope": "membership-credential",
      "cryptographic_binding_methods_supported": [
        "jwk"
      ],
      "credential_signing_alg_values_supported": [
        "ES256"
      ],
      "vct": "https://credentials.example.com/oauth-sig-membership",
      //...
    }
  }
  // ...
}
----

=== Enabling OpenID4VCI at the client level

Next, let's create a new client in the `oauth-sig-realm` realm to represent an application that members of the OAuth SIG will use to request and receive their membership credentials.
We will name this client `oauth-sig-client` and configure it as a standard OpenID Connect client.

During client creation, make sure to check the **Direct Access Grants** box, as we will use the *Resource Owner Password Credentials* (ROPC) flow to obtain a user access token in a later step. All other fields are left unchanged.

--
++++
<img src="${blogImages}/openid4vci/screenshot-client-creation.png" style="margin-bottom:2em" alt="Screenshot: Client Creation">
++++
--

One important point to note is that clients must explicitly enable OpenID4VCI to be able to use it.
Navigate to the *Advanced* tab of the `oauth-sig-client` client and toggle the **Enable OID4VCI** switch under the *OpenID for Verifiable Credentials* section.

--
++++
<img src="${blogImages}/openid4vci/screenshot-client-enable-oid4vci.png" style="margin-bottom:2em" alt="Screenshot: Enable OpenID4VCI on Client">
++++
--

Finally, we need to assign the previously created `membership-credential` client scope to the `oauth-sig-client` client. To do this, navigate to the **Client Scopes** tab of the `oauth-sig-client` client and add `membership-credential` as an **Optional Client Scope**.

--
++++
<img src="${blogImages}/openid4vci/screenshot-assign-credential-type-to-client.png" style="margin-bottom:2em" alt="Screenshot: Assigning membership-credential client scope to the client">
++++
--

== Obtaining a User Access Token

With the client configured and the user's password set, we can now proceed to obtain a *user access token*. This token will be used to authorize the credential offer request.

[source,sh]
----
USER_TOKEN=$(curl -s -X POST "http://<keycloak.instance>/realms/oauth-sig-realm/protocol/openid-connect/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=<user-username>" \
  -d "password=<user-password>" \
  -d "grant_type=password" \
  -d "client_id=oauth-sig-client" | jq -r '.access_token' )
echo "User Access Token obtained: $USER_TOKEN"
----

Let's use this *user token* to request a credential offer from the Keycloak issuer in the next step.

== Retrieving a credential offer to start the issuance flow

For Pre-Authorized Code flows, OpenID4VCI issuance can be initiated by retrieving a credential offer from Keycloak at the Credential Offer Endpoint. The endpoint requires a valid user access token and a target user ID for the pre-authorized offer.

[source,sh]
----
curl -X GET "http://<keycloak.instance>/realms/oauth-sig-realm/protocol/oid4vc/credential-offer-uri?credential_configuration_id=membership-credential&type=qr-code&user_id=<username>" \
  -H "Authorization: Bearer $USER_TOKEN" \
  --output credential-offer-qr.png
----

NOTE: Replace `<username>` with the user you created earlier.  
The QR code image is saved as `credential-offer-qr.png`. Open this file and use your wallet to redeem the credential.

The response contains a QR code representation of the credential offer, which can be scanned by a wallet application to proceed with the issuance flow.

With the query parameter `type=qr-code`, the response is a *direct binary representation of the QR code image*. If omitted, the endpoint returns JSON, and extra steps are needed to construct the QR code from the offer data.

--
++++
<div class="paragraph" style="margin-top:1em;margin-bottom:2em;">
    <img src="${blogImages}/openid4vci/qrcode-generation-overview.png" alt="QR Code Generation Overview" style="border:none;display:block;max-width:800px;height:auto;margin:0 auto;">
</div>
++++
--

Upon scanning the QR code with a compatible wallet, a membership credential is issued to the requesting user.

### ⚠️ Wallet Compatibility Notice

Keycloak implements the **final OpenID4VCI specification**, but also provides **backward compatibility with Draft-15** to support existing wallets.

The following wallets (still on Draft-15) were tested and work with Keycloak:

[cols="1,1", options="header"]
|===
| Wallet | Compatibility

| **Heidi Wallet**
| ✅ Works via Draft-15 backward compatibility

| **Valera Wallet**
| ✅ Works via Draft-15 backward compatibility

| **Lissi Wallet**
| ✅ Works via Draft-15 backward compatibility
|===

--
++++
<div class="paragraph" style="margin-top:1em;margin-bottom:2em;">
    <img src="${blogImages}/openid4vci/screenshot-wallet-steps.png" alt="Screenshot: Wallet Steps" style="border:none;display:block;max-width:100%;height:auto;margin:0 auto;">
</div>
++++
--

== Before You Go

In this blog post, we have illustrated how to set up Keycloak for issuing verifiable credentials over OpenID4VCI, using a simple scenario of issuing membership credentials to members of the OAuth SIG group.
We covered the necessary configuration steps at the realm, client scope, and client levels, and demonstrated how to retrieve a credential offer to initiate the issuance flow.
If you are looking into streamlining this configuration process for OpenID4VCI in Keycloak, take a look at our https://github.com/adorsys/keycloak-ssi-deployment[Keycloak SSI deployment] project, designed exactly for that purpose.
